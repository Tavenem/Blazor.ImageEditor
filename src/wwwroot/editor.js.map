{"version":3,"file":"editor.js","sources":["../ts/editor.js"],"sourcesContent":["class EllipseDrawTool {\r\n    constructor() {\r\n        this.originX = 0;\r\n        this.originY = 0;\r\n        this.drawingMode = 0;\r\n    }\r\n    make(startX, startY, endX, endY, options, shift) {\r\n        this.originX = startX;\r\n        this.originY = startY;\r\n        if (shift) {\r\n            const size = Math.max(Math.abs(startX - endX), Math.abs(startY - endY));\r\n            endX = startX > endX\r\n                ? startX - size\r\n                : startX + size;\r\n            endY = startY > endY\r\n                ? startY - size\r\n                : startY + size;\r\n        }\r\n        return new fabric.Ellipse({\r\n            left: endX < startX ? endX : startX,\r\n            top: endY < startY ? endY : startY,\r\n            rx: Math.abs(endX - startX) / 2,\r\n            ry: Math.abs(endX - startX) / 2,\r\n            ...options\r\n        });\r\n    }\r\n    resize(object, x, y, ctl, alt, shift) {\r\n        if (object instanceof fabric.Ellipse) {\r\n            if (shift) {\r\n                const size = Math.max(Math.abs(this.originX - x), Math.abs(this.originY - y));\r\n                x = this.originX > x\r\n                    ? this.originX - size\r\n                    : this.originX + size;\r\n                y = this.originY > y\r\n                    ? this.originY - size\r\n                    : this.originY + size;\r\n            }\r\n            object.set({\r\n                originX: this.originX > x ? 'right' : 'left',\r\n                originY: this.originY > y ? 'bottom' : 'top',\r\n                rx: Math.abs(this.originX - x) / 2,\r\n                ry: Math.abs(this.originY - y) / 2,\r\n            }).setCoords();\r\n        }\r\n        return object;\r\n    }\r\n}\r\nclass LineDrawTool {\r\n    constructor() {\r\n        this.drawingMode = 1;\r\n    }\r\n    make(startX, startY, endX, endY, options, shift) {\r\n        if (shift) {\r\n            const sizeX = Math.abs(startX - endX);\r\n            const sizeY = Math.abs(startY - endY);\r\n            const maxSize = Math.max(sizeX, sizeY);\r\n            if (Math.abs(sizeX - sizeY) <= 3) {\r\n                endX = startX > endX\r\n                    ? startX - maxSize\r\n                    : startX + maxSize;\r\n                endY = startY > endY\r\n                    ? startY - maxSize\r\n                    : startY + maxSize;\r\n            }\r\n            else if (sizeX > sizeY) {\r\n                endX = startX > endX\r\n                    ? startX - maxSize\r\n                    : startX + maxSize;\r\n                endY = startY;\r\n            }\r\n            else {\r\n                endX = startX;\r\n                endY = startY > endY\r\n                    ? startY - maxSize\r\n                    : startY + maxSize;\r\n            }\r\n        }\r\n        return new fabric.Line([startX, startY, endX, endY], options);\r\n    }\r\n    resize(object, x, y, ctl, alt, shift) {\r\n        if (object instanceof fabric.Line) {\r\n            if (shift) {\r\n                const sizeX = Math.abs((object.x1 ?? 0) - x);\r\n                const sizeY = Math.abs((object.y1 ?? 0) - y);\r\n                const maxSize = Math.max(sizeX, sizeY);\r\n                if (Math.abs(sizeX - sizeY) <= 3) {\r\n                    x = (object.x1 ?? 0) > x\r\n                        ? (object.x1 ?? 0) - maxSize\r\n                        : (object.x1 ?? 0) + maxSize;\r\n                    y = (object.y1 ?? 0) > y\r\n                        ? (object.y1 ?? 0) - maxSize\r\n                        : (object.y1 ?? 0) + maxSize;\r\n                }\r\n                else if (sizeX > sizeY) {\r\n                    x = (object.x1 ?? 0) > x\r\n                        ? (object.x1 ?? 0) - maxSize\r\n                        : (object.x1 ?? 0) + maxSize;\r\n                    y = (object.y1 ?? 0);\r\n                }\r\n                else {\r\n                    x = (object.x1 ?? 0);\r\n                    y = (object.y1 ?? 0) > y\r\n                        ? (object.y1 ?? 0) - maxSize\r\n                        : (object.y1 ?? 0) + maxSize;\r\n                }\r\n            }\r\n            object.set({\r\n                x2: x,\r\n                y2: y\r\n            }).setCoords();\r\n        }\r\n        return object;\r\n    }\r\n}\r\nclass PathDrawTool {\r\n    constructor() {\r\n        this.drawingMode = 1;\r\n    }\r\n    addPoint(object, x, y) {\r\n        const path = object.path;\r\n        const points = path.length + 1;\r\n        path.push([\r\n            'Q',\r\n            x, y,\r\n            x, y\r\n        ]);\r\n        const center = object.getCenterPoint(), newPathObject = new fabric.Path(path);\r\n        object.set({\r\n            path: newPathObject.path,\r\n            width: newPathObject.width,\r\n            height: newPathObject.height,\r\n            dirty: true,\r\n            pathOffset: newPathObject.pathOffset\r\n        }).setCoords();\r\n        object.setPositionByOrigin(center, 'center', 'center');\r\n        this.addControlPoint(object, points - 1);\r\n    }\r\n    make(startX, startY, endX, endY, options, shift) {\r\n        const path = [[], []];\r\n        if (shift) {\r\n            const sizeX = Math.abs(startX - endX);\r\n            const sizeY = Math.abs(startY - endY);\r\n            const maxSize = Math.max(sizeX, sizeY);\r\n            if (Math.abs(sizeX - sizeY) <= 3) {\r\n                endX = startX > endX\r\n                    ? startX - maxSize\r\n                    : startX + maxSize;\r\n                endY = startY > endY\r\n                    ? startY - maxSize\r\n                    : startY + maxSize;\r\n            }\r\n            else if (sizeX > sizeY) {\r\n                endX = startX > endX\r\n                    ? startX - maxSize\r\n                    : startX + maxSize;\r\n                endY = startY;\r\n            }\r\n            else {\r\n                endX = startX;\r\n                endY = startY > endY\r\n                    ? startY - maxSize\r\n                    : startY + maxSize;\r\n            }\r\n        }\r\n        path[0][0] = 'M';\r\n        path[0][1] = startX;\r\n        path[0][2] = startY;\r\n        path[1][0] = 'Q';\r\n        path[1][1] = endX;\r\n        path[1][2] = endY;\r\n        path[1][3] = endX;\r\n        path[1][4] = endY;\r\n        const obj = new fabric.Path(path, options);\r\n        obj.controls = { ...fabric.Object.prototype.controls };\r\n        obj.controls['csc'] = new fabric.Control({\r\n            positionHandler: this.curvePositionHandler,\r\n            actionHandler: this.curveActionHandler,\r\n            actionName: 'modifyCurve',\r\n        });\r\n        let cc = obj.controls['csc'];\r\n        cc.pointIndex = 0;\r\n        this.addControlPoint(obj, 1);\r\n        return obj;\r\n    }\r\n    resize(object, x, y, ctl, alt, shift) {\r\n        if (object instanceof fabric.Path && object.path) {\r\n            const objectPath = object.path;\r\n            const movingPointIndex = objectPath.length - 1;\r\n            if (shift && movingPointIndex === 1) {\r\n                const sizeX = Math.abs(objectPath[0][1] - x);\r\n                const sizeY = Math.abs(objectPath[0][2] - y);\r\n                const maxSize = Math.max(sizeX, sizeY);\r\n                if (Math.abs(sizeX - sizeY) <= 3) {\r\n                    x = objectPath[0][1] > x\r\n                        ? objectPath[0][1] - maxSize\r\n                        : objectPath[0][1] + maxSize;\r\n                    y = objectPath[0][2] > y\r\n                        ? objectPath[0][2] - maxSize\r\n                        : objectPath[0][2] + maxSize;\r\n                }\r\n                else if (sizeX > sizeY) {\r\n                    x = objectPath[0][1] > x\r\n                        ? objectPath[0][1] - maxSize\r\n                        : objectPath[0][1] + maxSize;\r\n                    y = objectPath[0][2];\r\n                }\r\n                else {\r\n                    x = objectPath[0][1];\r\n                    y = objectPath[0][2] > y\r\n                        ? objectPath[0][2] - maxSize\r\n                        : objectPath[0][2] + maxSize;\r\n                }\r\n            }\r\n            const path = objectPath;\r\n            path[movingPointIndex][1] = x;\r\n            path[movingPointIndex][2] = y;\r\n            path[movingPointIndex][3] = x;\r\n            path[movingPointIndex][4] = y;\r\n            const center = object.getCenterPoint(), newPathObject = new fabric.Path(path);\r\n            object.set({\r\n                path: newPathObject.path,\r\n                width: newPathObject.width,\r\n                height: newPathObject.height,\r\n                dirty: true,\r\n                pathOffset: newPathObject.pathOffset\r\n            });\r\n            if (movingPointIndex === 1) {\r\n                object.set({\r\n                    left: x < objectPath[0][1]\r\n                        ? x\r\n                        : objectPath[0][1],\r\n                    top: y < objectPath[0][2]\r\n                        ? y\r\n                        : objectPath[0][2]\r\n                });\r\n            }\r\n            object.setCoords();\r\n            if (movingPointIndex !== 1) {\r\n                object.setPositionByOrigin(center, 'center', 'center');\r\n            }\r\n        }\r\n        return object;\r\n    }\r\n    addControlPoint(object, index) {\r\n        object.controls[`cqc${index}`] = new fabric.Control({\r\n            positionHandler: this.curvePositionHandler,\r\n            actionHandler: this.curveActionHandler,\r\n            actionName: 'modifyCurve',\r\n        });\r\n        let cc = object.controls[`cqc${index}`];\r\n        cc.pointIndex = index;\r\n        cc.pointIsCurve = true;\r\n        object.controls[`cpc${index}`] = new fabric.Control({\r\n            positionHandler: this.curvePositionHandler,\r\n            actionHandler: this.curveActionHandler,\r\n            actionName: 'modifyCurve',\r\n        });\r\n        cc = object.controls[`cpc${index}`];\r\n        cc.pointIndex = index;\r\n    }\r\n    curveActionHandler(eventData, transform, x, y) {\r\n        if (!(transform.target instanceof fabric.Path)) {\r\n            return false;\r\n        }\r\n        const activeItem = transform.target, path = activeItem.path;\r\n        const currentControl = activeItem.controls[activeItem.__corner], baseSize = activeItem._getNonTransformedDimensions(), size = activeItem._getTransformedDimensions(), strokeWidth = activeItem.strokeWidth ?? 1, stroke = {\r\n            x: activeItem.strokeUniform ? strokeWidth : strokeWidth * (activeItem.scaleX ?? 1),\r\n            y: activeItem.strokeUniform ? strokeWidth : strokeWidth * (activeItem.scaleY ?? 1)\r\n        }, scaleX = (baseSize.x - strokeWidth) / (size.x - stroke.x), scaleY = (baseSize.y - strokeWidth) / (size.y - stroke.x), localPoint = activeItem.toLocalPoint(new fabric.Point(x, y), 'center', 'center'), finalLocalPoint = new fabric.Point(localPoint.x * scaleX + activeItem.pathOffset.x, localPoint.y * scaleY + activeItem.pathOffset.y);\r\n        if (currentControl.pointIndex === 0) {\r\n            path[0][1] = finalLocalPoint.x;\r\n            path[0][2] = finalLocalPoint.y;\r\n        }\r\n        else if (currentControl.pointIsCurve) {\r\n            if (editor && editor.shift) {\r\n                path[currentControl.pointIndex][1] = path[currentControl.pointIndex][3];\r\n                path[currentControl.pointIndex][2] = path[currentControl.pointIndex][4];\r\n            }\r\n            else {\r\n                path[currentControl.pointIndex][1] = finalLocalPoint.x;\r\n                path[currentControl.pointIndex][2] = finalLocalPoint.y;\r\n            }\r\n        }\r\n        else {\r\n            if ((path[currentControl.pointIndex][1] === path[currentControl.pointIndex][3])\r\n                && (path[currentControl.pointIndex][2] === path[currentControl.pointIndex][4])) {\r\n                path[currentControl.pointIndex][1] = finalLocalPoint.x;\r\n                path[currentControl.pointIndex][2] = finalLocalPoint.y;\r\n            }\r\n            path[currentControl.pointIndex][3] = finalLocalPoint.x;\r\n            path[currentControl.pointIndex][4] = finalLocalPoint.y;\r\n        }\r\n        const center = activeItem.getCenterPoint(), newPathObject = new fabric.Path(path);\r\n        activeItem.set({\r\n            path: newPathObject.path,\r\n            width: newPathObject.width,\r\n            height: newPathObject.height,\r\n            dirty: true,\r\n            pathOffset: newPathObject.pathOffset\r\n        }).setCoords();\r\n        activeItem.setPositionByOrigin(center, 'center', 'center');\r\n        return true;\r\n    }\r\n    curvePositionHandler(dim, finalMatrix, fabricObject) {\r\n        if (!(fabricObject instanceof fabric.Path)) {\r\n            return new fabric.Point(0, 0);\r\n        }\r\n        const path = fabricObject.path;\r\n        let x, y;\r\n        if (this.pointIndex === 0) {\r\n            x = path[0][1] - fabricObject.pathOffset.x;\r\n            y = path[0][2] - fabricObject.pathOffset.y;\r\n        }\r\n        else if (this.pointIsCurve) {\r\n            if ((path[this.pointIndex][1] === path[this.pointIndex][3]) && (path[this.pointIndex][2] === path[this.pointIndex][4])) {\r\n                const previousPointX = this.pointIndex === 1 ? 1 : 3;\r\n                const previousPointY = this.pointIndex === 1 ? 2 : 4;\r\n                x = ((path[this.pointIndex - 1][previousPointX] + path[this.pointIndex][3]) / 2) - fabricObject.pathOffset.x;\r\n                y = ((path[this.pointIndex - 1][previousPointY] + path[this.pointIndex][4]) / 2) - fabricObject.pathOffset.y;\r\n            }\r\n            else {\r\n                x = path[this.pointIndex][1] - fabricObject.pathOffset.x;\r\n                y = path[this.pointIndex][2] - fabricObject.pathOffset.y;\r\n            }\r\n        }\r\n        else {\r\n            x = path[this.pointIndex][3] - fabricObject.pathOffset.x;\r\n            y = path[this.pointIndex][4] - fabricObject.pathOffset.y;\r\n        }\r\n        if (fabricObject.canvas\r\n            && fabricObject.canvas.viewportTransform) {\r\n            return fabric.util.transformPoint(new fabric.Point(x, y), fabric.util.multiplyTransformMatrices(fabricObject.canvas.viewportTransform, fabricObject.calcTransformMatrix()));\r\n        }\r\n        else {\r\n            return fabric.util.transformPoint(new fabric.Point(x, y), fabricObject.calcTransformMatrix());\r\n        }\r\n    }\r\n}\r\nclass RectangleDrawTool {\r\n    constructor() {\r\n        this.originX = 0;\r\n        this.originY = 0;\r\n        this.drawingMode = 2;\r\n    }\r\n    make(startX, startY, endX, endY, options, shift) {\r\n        this.originX = startX;\r\n        this.originY = startY;\r\n        if (shift) {\r\n            const size = Math.max(Math.abs(startX - endX), Math.abs(startY - endY));\r\n            endX = startX > endX\r\n                ? startX - size\r\n                : startX + size;\r\n            endY = startY > endY\r\n                ? startY - size\r\n                : startY + size;\r\n        }\r\n        return new fabric.Rect({\r\n            left: endX < startX ? endX : startX,\r\n            top: endY < startY ? endY : startY,\r\n            width: Math.abs(startX - endX),\r\n            height: Math.abs(startY - endY),\r\n            ...options\r\n        });\r\n    }\r\n    resize(object, x, y, ctl, alt, shift) {\r\n        if (object instanceof fabric.Rect) {\r\n            if (shift) {\r\n                const size = Math.max(Math.abs(this.originX - x), Math.abs(this.originY - y));\r\n                x = this.originX > x\r\n                    ? this.originX - size\r\n                    : this.originX + size;\r\n                y = this.originY > y\r\n                    ? this.originY - size\r\n                    : this.originY + size;\r\n            }\r\n            object.set({\r\n                originX: this.originX > x ? 'right' : 'left',\r\n                originY: this.originY > y ? 'bottom' : 'top',\r\n                width: Math.abs(this.originX - x),\r\n                height: Math.abs(this.originY - y),\r\n            }).setCoords();\r\n        }\r\n        return object;\r\n    }\r\n}\r\nclass TextDrawTool {\r\n    constructor() {\r\n        this.originX = 0;\r\n        this.originY = 0;\r\n        this.drawingMode = 4;\r\n    }\r\n    make(startX, startY, endX, endY, options, shift, font) {\r\n        this.originX = startX;\r\n        this.originY = startY;\r\n        let sizeX = endX - startX;\r\n        let sizeY = endY - startY;\r\n        let size = 0;\r\n        if (shift) {\r\n            const absSizeX = Math.abs(sizeX);\r\n            const absSizeY = Math.abs(sizeY);\r\n            const xGreater = absSizeX >= absSizeY;\r\n            const maxSize = xGreater ? sizeX : sizeY;\r\n            if (Math.abs(absSizeX - absSizeY) <= 3) {\r\n                if (xGreater) {\r\n                    sizeX = maxSize;\r\n                    sizeY = maxSize * (sizeX >= 0 !== sizeY >= 0 ? -1 : 1);\r\n                }\r\n                else {\r\n                    sizeX = maxSize * (sizeX >= 0 !== sizeY >= 0 ? -1 : 1);\r\n                    sizeY = maxSize;\r\n                }\r\n                size = Math.abs(Math.sqrt((maxSize * maxSize) * 2));\r\n            }\r\n            else if (xGreater) {\r\n                sizeY = 0;\r\n                size = Math.abs(maxSize);\r\n            }\r\n            else {\r\n                sizeX = 0;\r\n                size = Math.abs(maxSize);\r\n            }\r\n        }\r\n        else {\r\n            size = Math.abs(Math.sqrt((sizeX * sizeX) + (sizeY * sizeY)));\r\n        }\r\n        let angle = Math.atan2(sizeY, sizeX);\r\n        angle *= 180 / Math.PI;\r\n        angle -= 90;\r\n        const opt = {\r\n            left: endX < startX ? endX : startX,\r\n            top: endY < startY ? endY : startY,\r\n            fontSize: size,\r\n            angle: angle,\r\n            fill: options.fill || (!options.stroke || options.stroke === 'transparent' ? 'black' : options.stroke),\r\n            stroke: options.stroke === 'transparent'\r\n                && (!options.fill || options.fill === 'transparent') ? 'black' : options.stroke,\r\n            strokeWidth: options.strokeWidth,\r\n            strokeUniform: true,\r\n            perPixelTargetFind: true,\r\n            selectable: true,\r\n        };\r\n        if (font) {\r\n            opt.fontFamily = font;\r\n        }\r\n        const text = new fabric.IText('', opt);\r\n        text.controls['tqc'] = new fabric.Control({\r\n            positionHandler: this.textCurvePositionHandler,\r\n            actionHandler: this.textCurveActionHandler,\r\n            actionName: 'modifyTextCurve'\r\n        });\r\n        text.enterEditing();\r\n        return text;\r\n    }\r\n    resize(object, x, y, ctl, alt, shift) {\r\n        if (object instanceof fabric.IText) {\r\n            let sizeX = x - this.originX;\r\n            let sizeY = y - this.originY;\r\n            let size = 0;\r\n            if (shift) {\r\n                const absSizeX = Math.abs(sizeX);\r\n                const absSizeY = Math.abs(sizeY);\r\n                const xGreater = absSizeX >= absSizeY;\r\n                const maxSize = xGreater ? sizeX : sizeY;\r\n                if (Math.abs(absSizeX - absSizeY) <= 3) {\r\n                    if (xGreater) {\r\n                        sizeX = maxSize;\r\n                        sizeY = maxSize * (sizeX >= 0 !== sizeY >= 0 ? -1 : 1);\r\n                    }\r\n                    else {\r\n                        sizeX = maxSize * (sizeX >= 0 !== sizeY >= 0 ? -1 : 1);\r\n                        sizeY = maxSize;\r\n                    }\r\n                    size = Math.abs(Math.sqrt((maxSize * maxSize) * 2));\r\n                }\r\n                else if (xGreater) {\r\n                    sizeY = 0;\r\n                    size = Math.abs(maxSize);\r\n                }\r\n                else {\r\n                    sizeX = 0;\r\n                    size = Math.abs(maxSize);\r\n                }\r\n            }\r\n            else {\r\n                size = Math.abs(Math.sqrt((sizeX * sizeX) + (sizeY * sizeY)));\r\n            }\r\n            let angle = Math.atan2(sizeY, sizeX);\r\n            angle *= 180 / Math.PI;\r\n            angle -= 90;\r\n            object.set({\r\n                fontSize: size,\r\n                angle: angle,\r\n            }).setCoords();\r\n        }\r\n        return object;\r\n    }\r\n    textCurveActionHandler(eventData, transform, x, y) {\r\n        const activeItem = transform.target;\r\n        if (!editor || !(activeItem instanceof fabric.IText)) {\r\n            return false;\r\n        }\r\n        if (editor && editor.shift) {\r\n            activeItem.curvePoint = { x: 0, y: 0 };\r\n            activeItem.path = undefined;\r\n            return activeItem.curvePoint\r\n                && (activeItem.curvePoint.x !== 0\r\n                    || activeItem.curvePoint.y !== 0);\r\n        }\r\n        const width = activeItem.width, rotateMatrix = activeItem._calcRotateMatrix(), translateMatrix = activeItem._calcTranslateMatrix(), vpt = activeItem.getViewportTransform(), startMatrix = fabric.util.multiplyTransformMatrices(vpt, translateMatrix);\r\n        let finalMatrix = fabric.util.multiplyTransformMatrices(startMatrix, rotateMatrix);\r\n        finalMatrix = fabric.util.multiplyTransformMatrices(finalMatrix, [1 / vpt[0], 0, 0, 1 / vpt[3], 0, 0]);\r\n        const dim = activeItem._calculateCurrentDimensions(), pathLeft = fabric.util.transformPoint(new fabric.Point(-0.5 * dim.x, 0), finalMatrix), pathRight = fabric.util.transformPoint(new fabric.Point(0.5 * dim.x, 0), finalMatrix), path = [[\r\n                'M',\r\n                pathLeft.x, pathLeft.y\r\n            ], [\r\n                'Q',\r\n                x, y,\r\n                pathRight.x, pathRight.y\r\n            ]], pathObject = new fabric.Path(path), curvePoint = fabric.util.transformPoint(new fabric.Point(x, y), fabric.util.invertTransform(finalMatrix)), scaledCurvePoint = { x: curvePoint.x / dim.x, y: curvePoint.y / dim.y };\r\n        activeItem.curvePoint = scaledCurvePoint;\r\n        editor.fabricCanvas.add(pathObject);\r\n        pathObject.set({ width: width }).setCoords();\r\n        activeItem.set({ path: pathObject });\r\n        editor.fabricCanvas.remove(pathObject);\r\n        return true;\r\n    }\r\n    textCurvePositionHandler(dim, finalMatrix, fabricObject) {\r\n        if (!(fabricObject instanceof fabric.IText)) {\r\n            return new fabric.Point(0, 0);\r\n        }\r\n        if (!fabricObject.curvePoint) {\r\n            fabricObject.curvePoint = { x: 0, y: 0 };\r\n        }\r\n        return fabric.util.transformPoint(new fabric.Point(fabricObject.curvePoint.x * dim.x, fabricObject.curvePoint.y * dim.y), finalMatrix);\r\n    }\r\n}\r\nclass TriangleDrawTool {\r\n    constructor() {\r\n        this.originX = 0;\r\n        this.originY = 0;\r\n        this.drawingMode = 5;\r\n    }\r\n    make(startX, startY, endX, endY, options, shift) {\r\n        this.originX = startX;\r\n        this.originY = startY;\r\n        if (shift) {\r\n            const size = Math.max(Math.abs(startX - endX), Math.abs(startY - endY));\r\n            endX = startX > endX\r\n                ? startX - size\r\n                : startX + size;\r\n            endY = startY > endY\r\n                ? startY - size\r\n                : startY + size;\r\n        }\r\n        return new fabric.Triangle({\r\n            left: endX < startX ? endX : startX,\r\n            top: endY < startY ? endY : startY,\r\n            width: Math.abs(startX - endX),\r\n            height: Math.abs(startY - endY),\r\n            ...options\r\n        });\r\n    }\r\n    resize(object, x, y, ctl, alt, shift) {\r\n        if (object instanceof fabric.Triangle) {\r\n            if (shift) {\r\n                const size = Math.max(Math.abs(this.originX - x), Math.abs(this.originY - y));\r\n                x = this.originX > x\r\n                    ? this.originX - size\r\n                    : this.originX + size;\r\n                y = this.originY > y\r\n                    ? this.originY - size\r\n                    : this.originY + size;\r\n            }\r\n            object.set({\r\n                originX: this.originX > x ? 'right' : 'left',\r\n                originY: this.originY > y ? 'bottom' : 'top',\r\n                width: Math.abs(this.originX - x),\r\n                height: Math.abs(this.originY - y),\r\n            }).setCoords();\r\n        }\r\n        return object;\r\n    }\r\n}\r\nclass StateManager {\r\n    constructor(fabricCanvas) {\r\n        this.fabricCanvas = fabricCanvas;\r\n        this._locked = false;\r\n        this._maxCount = 100;\r\n        this._redoStack = [];\r\n        this._undoStack = [];\r\n        this._currentState = fabricCanvas.toDatalessJSON();\r\n    }\r\n    redo(callback) {\r\n        this.applyState(this._undoStack, this._redoStack.pop(), callback);\r\n    }\r\n    saveState() {\r\n        if (this._locked) {\r\n            return;\r\n        }\r\n        if (this._undoStack.length >= this._maxCount) {\r\n            this._undoStack.shift();\r\n        }\r\n        this._undoStack.push(this._currentState);\r\n        this._currentState = this.fabricCanvas.toDatalessJSON();\r\n        this._redoStack = [];\r\n    }\r\n    undo(callback) {\r\n        this.applyState(this._redoStack, this._undoStack.pop(), callback);\r\n    }\r\n    applyState(stack, state, callback) {\r\n        if (!state) {\r\n            return;\r\n        }\r\n        stack.push(this._currentState);\r\n        this._currentState = state;\r\n        const self = this;\r\n        this._locked = true;\r\n        this.fabricCanvas.loadFromJSON(this._currentState, function () {\r\n            if (typeof callback === 'function') {\r\n                callback();\r\n            }\r\n            self._locked = false;\r\n        });\r\n    }\r\n}\r\nclass EditorClipboard {\r\n    constructor(editor) {\r\n        this.editor = editor;\r\n    }\r\n    copy(callback) {\r\n        this.editor.fabricCanvas.getActiveObject().clone((object) => {\r\n            this._clipObject = object;\r\n            if (typeof (callback) === 'function') {\r\n                callback();\r\n            }\r\n        });\r\n    }\r\n    cut() {\r\n        this.copy(() => this.editor.deleteObjects());\r\n    }\r\n    paste() {\r\n        if (!this._clipObject) {\r\n            return;\r\n        }\r\n        this._clipObject.clone((clonedObject) => {\r\n            this.editor.fabricCanvas.discardActiveObject();\r\n            if (clonedObject.type === 'activeSelection') {\r\n                clonedObject.canvas = this.editor.fabricCanvas;\r\n                let self = this;\r\n                clonedObject.forEachObject(function (obj) {\r\n                    self.editor.fabricCanvas.add(obj);\r\n                });\r\n                clonedObject.setCoords();\r\n            }\r\n            else {\r\n                this.editor.fabricCanvas.add(clonedObject);\r\n            }\r\n            this.editor.fabricCanvas.setActiveObject(clonedObject);\r\n            this.editor.fabricCanvas.requestRenderAll();\r\n            this.editor.stateManager.saveState();\r\n        });\r\n    }\r\n}\r\nclass Editor {\r\n    constructor(editorCanvas) {\r\n        this._alt = false;\r\n        this._ctl = false;\r\n        this._shift = false;\r\n        this._space = false;\r\n        this._aspectRatio = 4 / 3;\r\n        this._cursorMode = 0;\r\n        this._enableRotation = true;\r\n        this._lastX = 0;\r\n        this._lastY = 0;\r\n        this._listeningForKeys = true;\r\n        this._mouseDown = false;\r\n        this._moving = false;\r\n        this._panning = false;\r\n        this._redraw = false;\r\n        this.editorCanvas = editorCanvas;\r\n        this._drawTools = [\r\n            new EllipseDrawTool(),\r\n            new LineDrawTool(),\r\n            new RectangleDrawTool(),\r\n            new PathDrawTool(),\r\n            new TextDrawTool(),\r\n            new TriangleDrawTool(),\r\n        ];\r\n        this._drawTool = this._drawTools[1];\r\n        this._drawToolOptions = {\r\n            fill: '',\r\n            shadow: '',\r\n            stroke: 'black',\r\n            strokeWidth: 1,\r\n            perPixelTargetFind: true,\r\n            selectable: true,\r\n            strokeUniform: true,\r\n        };\r\n        this.fabricCanvas = new fabric.Canvas(this.editorCanvas, { selection: false });\r\n        if (this.editorCanvas.parentElement\r\n            && this.editorCanvas.parentElement.parentElement) {\r\n            const bounds = this.editorCanvas.parentElement.parentElement.getBoundingClientRect();\r\n            this.fabricCanvas.setDimensions({ width: bounds.width, height: Math.round(bounds.width / this._aspectRatio) });\r\n        }\r\n        this.initializeEvents();\r\n        this.stateManager = new StateManager(this.fabricCanvas);\r\n        this.clipboard = new EditorClipboard(this);\r\n    }\r\n    get alt() { return this._alt; }\r\n    get ctl() { return this._ctl; }\r\n    get shift() { return this._shift; }\r\n    get space() { return this._space; }\r\n    bringForward() {\r\n        this.fabricCanvas.getActiveObject().bringForward(true);\r\n    }\r\n    bringToFront() {\r\n        this.fabricCanvas.getActiveObject().bringToFront();\r\n    }\r\n    clear() {\r\n        this.fabricCanvas.clear();\r\n    }\r\n    copy() {\r\n        this.clipboard.copy();\r\n    }\r\n    cut() {\r\n        this.clipboard.cut();\r\n    }\r\n    dispose() {\r\n        window.removeEventListener(\"resize\", this.resizeEvent);\r\n        this.fabricCanvas.dispose();\r\n    }\r\n    deleteObjects() {\r\n        this.fabricCanvas.remove(...this.fabricCanvas.getActiveObjects());\r\n        this.fabricCanvas.discardActiveObject();\r\n        this.saveState();\r\n    }\r\n    enableRotation(value) {\r\n        if (this._enableRotation === value) {\r\n            return;\r\n        }\r\n        this._enableRotation = value;\r\n        this.fabricCanvas.forEachObject((obj) => {\r\n            obj.setControlVisible('mtr', value);\r\n        });\r\n    }\r\n    paste() {\r\n        this.clipboard.paste();\r\n    }\r\n    redo() {\r\n        this.stateManager.redo();\r\n    }\r\n    resizeEvent() {\r\n        if (this._resizeTimeout) {\r\n            clearTimeout(this._resizeTimeout);\r\n        }\r\n        const handler = () => {\r\n            if (this.editorCanvas.parentElement\r\n                && this.editorCanvas.parentElement.parentElement) {\r\n                this.fabricCanvas.setDimensions({\r\n                    width: \"10px\",\r\n                    height: \"10px\",\r\n                }, {\r\n                    cssOnly: true\r\n                });\r\n                this.resizeEventInner();\r\n            }\r\n        };\r\n        this._resizeTimeout = setTimeout(handler, 250);\r\n    }\r\n    sendBackwards() {\r\n        this.fabricCanvas.getActiveObject().sendBackwards(true);\r\n    }\r\n    sendToBack() {\r\n        this.fabricCanvas.getActiveObject().sendToBack();\r\n    }\r\n    setBackgroundImage(imageUrl) {\r\n        this._backgroundUrl = imageUrl;\r\n        if (imageUrl\r\n            && this.editorCanvas.parentElement\r\n            && this.editorCanvas.parentElement.parentElement) {\r\n            const self = this;\r\n            fabric.Image.fromURL(imageUrl, function (image) {\r\n                if (!image || !image.width || !image.height) {\r\n                    self.fabricCanvas.setBackgroundImage('', self.fabricCanvas.renderAll.bind(self.fabricCanvas));\r\n                    return;\r\n                }\r\n                self._aspectRatio = image.width / image.height;\r\n                if (self._borderWidth) {\r\n                    self.fabricCanvas.setDimensions({\r\n                        width: image.width + (self._borderWidth * 2),\r\n                        height: image.height + (self._borderWidth * 2),\r\n                    }, {\r\n                        backstoreOnly: true\r\n                    });\r\n                    self.fabricCanvas.setBackgroundImage(image, self.fabricCanvas.renderAll.bind(self.fabricCanvas), {\r\n                        top: self._borderWidth,\r\n                        left: self._borderWidth,\r\n                        originX: 'left',\r\n                        originY: 'top',\r\n                    });\r\n                }\r\n                else {\r\n                    self.fabricCanvas.setDimensions({\r\n                        width: image.width,\r\n                        height: image.height\r\n                    }, {\r\n                        backstoreOnly: true\r\n                    });\r\n                    self.fabricCanvas.setBackgroundImage(image, self.fabricCanvas.renderAll.bind(self.fabricCanvas));\r\n                }\r\n                self.resizeEvent();\r\n            });\r\n        }\r\n        else {\r\n            this.fabricCanvas.setBackgroundImage('', this.fabricCanvas.renderAll.bind(this.fabricCanvas));\r\n        }\r\n        this.saveState();\r\n    }\r\n    setBorderColor(color) {\r\n        if (this._borderColor !== color) {\r\n            this._borderColor = color;\r\n            if (this._borderWidth) {\r\n                this.drawBorder();\r\n            }\r\n        }\r\n    }\r\n    setBorderPercent(value) {\r\n        if (!value) {\r\n            this.setBorderWidth(value);\r\n            return;\r\n        }\r\n        const size = Math.min(this.fabricCanvas.width ?? 0, this.fabricCanvas.height ?? 0);\r\n        if (size > 0) {\r\n            this.setBorderWidth(size * value);\r\n        }\r\n    }\r\n    setBorderWidth(value) {\r\n        if (this._borderWidth !== value) {\r\n            this._borderWidth = value;\r\n            this.drawBorder();\r\n            if (this._backgroundUrl) {\r\n                this.setBackgroundImage(this._backgroundUrl);\r\n            }\r\n        }\r\n    }\r\n    setDrawingMode(mode) {\r\n        if (mode === 6) {\r\n            this.fabricCanvas.isDrawingMode = true;\r\n        }\r\n        else {\r\n            this.fabricCanvas.isDrawingMode = false;\r\n            this._drawTool = this._drawTools[mode];\r\n        }\r\n    }\r\n    setFillColor(color) {\r\n        if (color) {\r\n            this._drawToolOptions.fill = color;\r\n        }\r\n        else {\r\n            this._drawToolOptions.fill = '';\r\n        }\r\n        this.setToolOptions();\r\n    }\r\n    setFont(font) {\r\n        if (!font) {\r\n            return;\r\n        }\r\n        const self = this;\r\n        WebFont.load({\r\n            classes: false,\r\n            google: {\r\n                families: [font]\r\n            },\r\n            active: function () {\r\n                self._font = font;\r\n                const obj = self.fabricCanvas.getActiveObject();\r\n                if (obj instanceof fabric.IText) {\r\n                    obj.set({ fontFamily: font });\r\n                }\r\n            },\r\n        });\r\n    }\r\n    setLineCap(cap) {\r\n        this._drawToolOptions.strokeLineCap = cap;\r\n        this.setToolOptions();\r\n    }\r\n    setRedraw(value) {\r\n        this._redraw = value;\r\n    }\r\n    setStrokeColor(color) {\r\n        if (color) {\r\n            this._drawToolOptions.stroke = color;\r\n            this.fabricCanvas.freeDrawingBrush.color = color;\r\n        }\r\n        else {\r\n            this._drawToolOptions.stroke = 'transparent';\r\n            this.fabricCanvas.freeDrawingBrush.color = 'black';\r\n        }\r\n        this.setToolOptions();\r\n    }\r\n    setStrokeDash1(value) {\r\n        if (value) {\r\n            const dash = value * (this._drawToolOptions.strokeWidth ?? 1);\r\n            const other = this._drawToolOptions.strokeDashArray\r\n                && this._drawToolOptions.strokeDashArray.length\r\n                && this._drawToolOptions.strokeDashArray.length >= 3\r\n                ? this._drawToolOptions.strokeDashArray[2]\r\n                : dash;\r\n            let space = Math.max((this._drawToolOptions.strokeWidth ?? 1), Math.min(dash, other) / 2);\r\n            if (this._drawToolOptions.strokeLineCap === 'round') {\r\n                space += (this._drawToolOptions.strokeWidth ?? 1);\r\n            }\r\n            this._drawToolOptions.strokeDashArray = [dash, space, other, space];\r\n            this.fabricCanvas.freeDrawingBrush.strokeDashArray = [dash, space, other, space];\r\n        }\r\n        else {\r\n            this._drawToolOptions.strokeDashArray = undefined;\r\n            this.fabricCanvas.freeDrawingBrush.strokeDashArray = undefined;\r\n        }\r\n        this.setToolOptions();\r\n    }\r\n    setStrokeDash2(value) {\r\n        if (value) {\r\n            const dash = value * (this._drawToolOptions.strokeWidth ?? 1);\r\n            const other = this._drawToolOptions.strokeDashArray\r\n                && this._drawToolOptions.strokeDashArray.length\r\n                && this._drawToolOptions.strokeDashArray.length >= 1\r\n                ? this._drawToolOptions.strokeDashArray[0]\r\n                : dash;\r\n            let space = Math.max((this._drawToolOptions.strokeWidth ?? 1), Math.min(dash, other) / 2);\r\n            if (this._drawToolOptions.strokeLineCap === 'round') {\r\n                space += (this._drawToolOptions.strokeWidth ?? 1);\r\n            }\r\n            this._drawToolOptions.strokeDashArray = [other, space, dash, space];\r\n            this.fabricCanvas.freeDrawingBrush.strokeDashArray = [other, space, dash, space];\r\n        }\r\n        else {\r\n            this._drawToolOptions.strokeDashArray = undefined;\r\n            this.fabricCanvas.freeDrawingBrush.strokeDashArray = undefined;\r\n        }\r\n        this.setToolOptions();\r\n    }\r\n    setStrokeWidth(value) {\r\n        value ?? (value = 1);\r\n        if (this._drawToolOptions.strokeWidth === value) {\r\n            return;\r\n        }\r\n        if (this._drawToolOptions.strokeDashArray\r\n            && this._drawToolOptions.strokeDashArray.length\r\n            && this._drawToolOptions.strokeDashArray.length >= 3) {\r\n            const dash1 = this._drawToolOptions.strokeDashArray[0] * value / (this._drawToolOptions.strokeWidth ?? 1);\r\n            const dash2 = this._drawToolOptions.strokeDashArray[2] * value / (this._drawToolOptions.strokeWidth ?? 1);\r\n            const space = Math.max((this._drawToolOptions.strokeWidth ?? 1), Math.min(dash1, dash2) / 2);\r\n            this._drawToolOptions.strokeDashArray = [dash1, space, dash2, space];\r\n        }\r\n        this._drawToolOptions.strokeWidth = value;\r\n        this.fabricCanvas.freeDrawingBrush.width = value;\r\n        this.setToolOptions();\r\n    }\r\n    undo() {\r\n        this.stateManager.undo();\r\n    }\r\n    constrainView() {\r\n        const vpt = this.fabricCanvas.viewportTransform;\r\n        const zoom = this.fabricCanvas.getZoom();\r\n        if (!vpt) {\r\n            return;\r\n        }\r\n        const width = this.fabricCanvas.getWidth();\r\n        if (vpt[4] >= 0) {\r\n            vpt[4] = 0;\r\n        }\r\n        else if (vpt[4] < width - width * zoom) {\r\n            vpt[4] = width - width * zoom;\r\n        }\r\n        const height = this.fabricCanvas.getHeight();\r\n        if (vpt[5] >= 0) {\r\n            vpt[5] = 0;\r\n        }\r\n        else if (vpt[5] < height - height * zoom) {\r\n            vpt[5] = height - height * zoom;\r\n        }\r\n    }\r\n    drawBorder() {\r\n        if (this._border) {\r\n            this.fabricCanvas.remove(this._border);\r\n        }\r\n        if (!this._borderWidth) {\r\n            return;\r\n        }\r\n        this._border = new fabric.Rect({\r\n            left: 0,\r\n            top: 0,\r\n            width: this.fabricCanvas.getWidth() - this._borderWidth,\r\n            height: this.fabricCanvas.getHeight() - this._borderWidth,\r\n            fill: '',\r\n            stroke: this._borderColor || 'white',\r\n            strokeWidth: this._borderWidth,\r\n            selectable: false,\r\n            evented: false,\r\n        });\r\n        this.fabricCanvas.add(this._border);\r\n        this.fabricCanvas.requestRenderAll();\r\n    }\r\n    initializeEvents() {\r\n        this.fabricCanvas.on('mouse:down', (e) => {\r\n            const _e = e.e;\r\n            this._alt = _e.altKey;\r\n            this._ctl = _e.ctrlKey;\r\n            this._shift = _e.shiftKey;\r\n            const pointer = this.fabricCanvas.getPointer(e.e);\r\n            this.mouseDown(pointer.x, pointer.y);\r\n        });\r\n        this.fabricCanvas.on('mouse:move', (e) => {\r\n            if (this._mouseDown) {\r\n                const _e = e.e;\r\n                this._alt = _e.altKey;\r\n                this._ctl = _e.ctrlKey;\r\n                this._shift = _e.shiftKey;\r\n                const pointer = this.fabricCanvas.getPointer(e.e);\r\n                this.mouseMove(pointer.x, pointer.y);\r\n            }\r\n        });\r\n        this.fabricCanvas.on('mouse:up', (e) => {\r\n            this._mouseDown = false;\r\n            this.fabricCanvas.selection = true;\r\n            if (this._panning && this.fabricCanvas.viewportTransform) {\r\n                this.fabricCanvas.setViewportTransform(this.fabricCanvas.viewportTransform);\r\n            }\r\n            this._panning = false;\r\n            if (this._createdObject instanceof fabric.IText) {\r\n                this._cursorMode = 1;\r\n                if (this._createdObject.hiddenTextarea) {\r\n                    this._createdObject.hiddenTextarea.focus();\r\n                }\r\n            }\r\n            if (this._moving) {\r\n                if (this._createdObject) {\r\n                    this.fabricCanvas.setActiveObject(this._createdObject);\r\n                }\r\n                this.saveState();\r\n                this._moving = false;\r\n            }\r\n            this._createdObject = undefined;\r\n        });\r\n        this.fabricCanvas.on('mouse:wheel', (e) => {\r\n            const _e = e.e;\r\n            let zoom = Math.max(1, Math.min(20, this.fabricCanvas.getZoom() * (0.999 ** _e.deltaY)));\r\n            this.fabricCanvas.zoomToPoint(new fabric.Point(_e.offsetX, _e.offsetY), zoom);\r\n            _e.preventDefault();\r\n            _e.stopPropagation();\r\n            this.constrainView();\r\n        });\r\n        this.fabricCanvas.on('object:modified', (e) => {\r\n            this.saveState();\r\n        });\r\n        this.fabricCanvas.on('selection:created', (e) => {\r\n            this._cursorMode = 1;\r\n        });\r\n        this.fabricCanvas.on('selection:cleared', (e) => {\r\n            this._cursorMode = 0;\r\n        });\r\n        this.fabricCanvas.on('text:editing:entered', (e) => {\r\n            this._listeningForKeys = false;\r\n            this._cursorMode = 1;\r\n            const obj = e.target;\r\n            if (obj instanceof fabric.IText\r\n                && obj.curvePoint\r\n                && (obj.curvePoint.x !== 0\r\n                    || obj.curvePoint.y !== 0)) {\r\n                obj.curvePoint = { x: 0, y: 0 };\r\n                obj.path = undefined;\r\n            }\r\n        });\r\n        this.fabricCanvas.on('text:editing:exited', (e) => {\r\n            this._listeningForKeys = true;\r\n            this._cursorMode = 0;\r\n            if (e.target) {\r\n                this.fabricCanvas.setActiveObject(e.target);\r\n            }\r\n            this.saveState();\r\n        });\r\n        window.addEventListener(\"resize\", this.resizeEvent.bind(this));\r\n        window.addEventListener(\"keydown\", this.keyDownEvent.bind(this));\r\n        window.addEventListener(\"keyup\", this.keyUpEvent.bind(this));\r\n    }\r\n    keyDownEvent(ev) {\r\n        if (!this._listeningForKeys) {\r\n            return;\r\n        }\r\n        if (ev.key === \" \") {\r\n            this._space = true;\r\n        }\r\n        else if (ev.key === \"Delete\") {\r\n            this.deleteObjects();\r\n        }\r\n        else if (ev.key === \"Copy\"\r\n            || (ev.key === \"c\" && ev.ctrlKey)) {\r\n            this.copy();\r\n        }\r\n        else if (ev.key === \"Cut\"\r\n            || (ev.key === \"x\" && ev.ctrlKey)) {\r\n            this.cut();\r\n        }\r\n        else if (ev.key === \"Paste\"\r\n            || (ev.key === \"v\" && ev.ctrlKey)) {\r\n            this.paste();\r\n        }\r\n        else if (ev.key === \"Undo\"\r\n            || (ev.key === \"z\" && ev.ctrlKey)) {\r\n            this.undo();\r\n        }\r\n        else if (ev.key === \"Redo\"\r\n            || (ev.key === \"y\" && ev.ctrlKey)) {\r\n            this.redo();\r\n        }\r\n    }\r\n    keyUpEvent(ev) {\r\n        if (ev.key === \" \") {\r\n            this._space = false;\r\n        }\r\n    }\r\n    make(startX, startY, endX, endY) {\r\n        if (this._redraw) {\r\n            this.fabricCanvas.remove(...this.fabricCanvas.getObjects());\r\n        }\r\n        const obj = this._drawTool.make(startX, startY, endX, endY, this._drawToolOptions, this._shift, this._font);\r\n        if (!this._enableRotation) {\r\n            obj.setControlVisible('mtr', false);\r\n        }\r\n        this.fabricCanvas.add(obj);\r\n        this.saveState();\r\n        return obj;\r\n    }\r\n    mouseDown(x, y) {\r\n        if (this._space) {\r\n            this._mouseDown = true;\r\n            this._panning = true;\r\n            this.fabricCanvas.selection = false;\r\n            this._lastX = x;\r\n            this._lastY = y;\r\n        }\r\n        else if (this._alt) {\r\n            const obj = this.fabricCanvas.getActiveObject();\r\n            console.log(obj);\r\n            if (obj instanceof fabric.Path) {\r\n                const tool = this._drawTools[3];\r\n                this._mouseDown = true;\r\n                this.fabricCanvas.selection = false;\r\n                tool.addPoint(obj, x, y);\r\n                this.fabricCanvas.renderAll();\r\n            }\r\n        }\r\n        else if (this._cursorMode === 0\r\n            && !this.fabricCanvas.isDrawingMode\r\n            && !this._alt\r\n            && !this._ctl\r\n            && this.fabricCanvas.getActiveObjects().length === 0) {\r\n            this._mouseDown = true;\r\n            this.fabricCanvas.selection = false;\r\n            this._lastX = x;\r\n            this._lastY = y;\r\n        }\r\n    }\r\n    mouseMove(x, y) {\r\n        if (this._panning) {\r\n            const vpt = this.fabricCanvas.viewportTransform;\r\n            const zoom = this.fabricCanvas.getZoom();\r\n            if (vpt) {\r\n                vpt[4] += (x - this._lastX) * zoom;\r\n                vpt[5] += (y - this._lastY) * zoom;\r\n                this.constrainView();\r\n                this.fabricCanvas.requestRenderAll();\r\n            }\r\n            this._lastX = x;\r\n            this._lastY = y;\r\n        }\r\n        else if (this._createdObject) {\r\n            this._moving = true;\r\n            this._drawTool.resize(this._createdObject, x, y, this._ctl, this._alt, this._shift);\r\n            this.fabricCanvas.renderAll();\r\n        }\r\n        else {\r\n            this._createdObject = this.make(this._lastX, this._lastY, x, y);\r\n        }\r\n    }\r\n    resizeEventInner() {\r\n        if (this._resizeTimeoutInner) {\r\n            clearTimeout(this._resizeTimeoutInner);\r\n        }\r\n        const handler = () => {\r\n            if (this.editorCanvas.parentElement\r\n                && this.editorCanvas.parentElement.parentElement) {\r\n                const bounds = this.editorCanvas.parentElement.parentElement.getBoundingClientRect();\r\n                this.fabricCanvas.setDimensions({\r\n                    width: `${bounds.width}px`,\r\n                    height: `${Math.round(bounds.width / this._aspectRatio)}px`,\r\n                }, {\r\n                    cssOnly: true\r\n                });\r\n                this.drawBorder();\r\n            }\r\n        };\r\n        this._resizeTimeoutInner = setTimeout(handler, 10);\r\n    }\r\n    saveState() {\r\n        this.stateManager.saveState();\r\n        this.fabricCanvas.renderAll();\r\n    }\r\n    setToolOptions() {\r\n        this.fabricCanvas.getActiveObjects().forEach((obj) => {\r\n            obj.set(this._drawToolOptions);\r\n        });\r\n        this.fabricCanvas.requestRenderAll();\r\n    }\r\n}\r\nlet editor;\r\nexport function bringForward() {\r\n    if (editor) {\r\n        editor.bringForward();\r\n    }\r\n}\r\nexport function bringToFront() {\r\n    if (editor) {\r\n        editor.bringToFront();\r\n    }\r\n}\r\nexport function clear() {\r\n    if (editor) {\r\n        editor.clear();\r\n    }\r\n}\r\nexport function copy() {\r\n    if (editor) {\r\n        editor.copy();\r\n    }\r\n}\r\nexport function cut() {\r\n    if (editor) {\r\n        editor.cut();\r\n    }\r\n}\r\nexport function deleteObjects() {\r\n    if (editor) {\r\n        editor.deleteObjects();\r\n    }\r\n}\r\nexport function dispose() {\r\n    if (editor) {\r\n        editor.dispose();\r\n    }\r\n}\r\nexport function enableRotation(value) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.enableRotation(value || false);\r\n}\r\nexport function getJSON() {\r\n    if (editor) {\r\n        return JSON.stringify(editor.fabricCanvas);\r\n    }\r\n    return '';\r\n}\r\nexport async function getObjUrl() {\r\n    if (!editor) {\r\n        return \"\";\r\n    }\r\n    const url = await new Promise(function (resolve) {\r\n        if (editor) {\r\n            editor.fabricCanvas.discardActiveObject().renderAll();\r\n            editor.editorCanvas.toBlob((blob) => {\r\n                if (blob) {\r\n                    resolve(URL.createObjectURL(blob));\r\n                }\r\n                else {\r\n                    resolve(\"\");\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            resolve(\"\");\r\n        }\r\n    });\r\n    return url;\r\n}\r\nexport function loadEditor(editorCanvas, imageUrl) {\r\n    if (!editor) {\r\n        editor = new Editor(editorCanvas);\r\n    }\r\n    else {\r\n        editor.clear();\r\n    }\r\n    if (imageUrl) {\r\n        editor.setBackgroundImage(imageUrl);\r\n    }\r\n}\r\nexport function loadJSON(json) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    if (json) {\r\n        editor.fabricCanvas.loadFromJSON(json, () => {\r\n            const fonts = [];\r\n            editor.fabricCanvas.forEachObject((obj) => {\r\n                if (obj instanceof fabric.IText\r\n                    && obj.fontFamily) {\r\n                    fonts.push(obj.fontFamily);\r\n                }\r\n            });\r\n            if (fonts.length) {\r\n                WebFont.load({\r\n                    classes: false,\r\n                    google: {\r\n                        families: fonts\r\n                    },\r\n                    active: function () {\r\n                        editor.fabricCanvas.requestRenderAll();\r\n                    },\r\n                });\r\n            }\r\n        });\r\n    }\r\n}\r\nexport function paste() {\r\n    if (editor) {\r\n        editor.paste();\r\n    }\r\n}\r\nexport function redo() {\r\n    if (editor) {\r\n        editor.redo();\r\n    }\r\n}\r\nexport function resize() {\r\n    if (editor) {\r\n        editor.resizeEvent();\r\n    }\r\n}\r\nexport function revokeObjUrl(url) {\r\n    URL.revokeObjectURL(url);\r\n}\r\nexport function saveImage() {\r\n    if (editor) {\r\n        const link = document.createElement('a');\r\n        link.setAttribute('download', 'image.png');\r\n        link.setAttribute('href', editor.fabricCanvas.toDataURL({ format: 'image/png' }).replace('image/png', 'image/octet-stream'));\r\n        link.click();\r\n    }\r\n}\r\nexport function setBackgroundImage(imageUrl) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setBackgroundImage(imageUrl);\r\n}\r\nexport function sendBackwards() {\r\n    if (editor) {\r\n        editor.sendBackwards();\r\n    }\r\n}\r\nexport function sendToBack() {\r\n    if (editor) {\r\n        editor.sendToBack();\r\n    }\r\n}\r\nexport function setBorderColor(color) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setBorderColor(color);\r\n}\r\nexport function setBorderPercent(value) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setBorderPercent(value);\r\n}\r\nexport function setBorderWidth(value) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setBorderWidth(value);\r\n}\r\nexport function setDrawingMode(mode) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setDrawingMode(mode);\r\n}\r\nexport function setFillColor(color) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setFillColor(color);\r\n}\r\nexport function setFont(font) {\r\n    if (!font) {\r\n        return;\r\n    }\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setFont(font);\r\n}\r\nexport function setLineCap(cap) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setLineCap(cap);\r\n}\r\nexport function setRedraw(value) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setRedraw(value || false);\r\n}\r\nexport function setStrokeColor(color) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setStrokeColor(color);\r\n}\r\nexport function setStrokeDash1(value) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setStrokeDash1(value);\r\n}\r\nexport function setStrokeDash2(value) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setStrokeDash2(value);\r\n}\r\nexport function setStrokeWidth(value) {\r\n    if (!editor) {\r\n        return;\r\n    }\r\n    editor.setStrokeWidth(value);\r\n}\r\nexport function undo() {\r\n    if (editor) {\r\n        editor.undo();\r\n    }\r\n}\r\n//# sourceMappingURL=editor.js.map"],"names":["EllipseDrawTool","[object Object]","this","originX","originY","drawingMode","startX","startY","endX","endY","options","shift","size","Math","max","abs","fabric","Ellipse","left","top","rx","ry","object","x","y","ctl","alt","set","setCoords","LineDrawTool","sizeX","sizeY","maxSize","Line","x1","y1","x2","y2","PathDrawTool","path","points","length","push","center","getCenterPoint","newPathObject","Path","width","height","dirty","pathOffset","setPositionByOrigin","addControlPoint","obj","controls","Object","prototype","Control","positionHandler","curvePositionHandler","actionHandler","curveActionHandler","actionName","pointIndex","objectPath","movingPointIndex","index","cc","pointIsCurve","eventData","transform","target","activeItem","currentControl","__corner","baseSize","_getNonTransformedDimensions","_getTransformedDimensions","strokeWidth","stroke","strokeUniform","scaleX","scaleY","localPoint","toLocalPoint","Point","finalLocalPoint","editor","dim","finalMatrix","fabricObject","previousPointX","previousPointY","canvas","viewportTransform","util","transformPoint","multiplyTransformMatrices","calcTransformMatrix","RectangleDrawTool","Rect","TextDrawTool","font","absSizeX","absSizeY","xGreater","sqrt","angle","atan2","PI","opt","fontSize","fill","perPixelTargetFind","selectable","fontFamily","text","IText","textCurvePositionHandler","textCurveActionHandler","enterEditing","curvePoint","undefined","rotateMatrix","_calcRotateMatrix","translateMatrix","_calcTranslateMatrix","vpt","getViewportTransform","startMatrix","_calculateCurrentDimensions","pathLeft","pathRight","pathObject","invertTransform","scaledCurvePoint","fabricCanvas","add","remove","TriangleDrawTool","Triangle","StateManager","_locked","_maxCount","_redoStack","_undoStack","_currentState","toDatalessJSON","callback","applyState","pop","stack","state","self","loadFromJSON","EditorClipboard","getActiveObject","clone","_clipObject","copy","deleteObjects","clonedObject","discardActiveObject","type","forEachObject","setActiveObject","requestRenderAll","stateManager","saveState","Editor","editorCanvas","_alt","_ctl","_shift","_space","_aspectRatio","_cursorMode","_enableRotation","_lastX","_lastY","_listeningForKeys","_mouseDown","_moving","_panning","_redraw","_drawTools","_drawTool","_drawToolOptions","shadow","Canvas","selection","parentElement","bounds","getBoundingClientRect","setDimensions","round","initializeEvents","clipboard","space","bringForward","bringToFront","clear","cut","window","removeEventListener","resizeEvent","dispose","getActiveObjects","value","setControlVisible","paste","redo","_resizeTimeout","clearTimeout","setTimeout","cssOnly","resizeEventInner","sendBackwards","sendToBack","imageUrl","_backgroundUrl","Image","fromURL","image","_borderWidth","backstoreOnly","setBackgroundImage","renderAll","bind","color","_borderColor","drawBorder","setBorderWidth","min","mode","isDrawingMode","setToolOptions","WebFont","load","classes","google","families","active","_font","cap","strokeLineCap","freeDrawingBrush","dash","other","strokeDashArray","dash1","dash2","undo","zoom","getZoom","getWidth","getHeight","_border","evented","on","e","_e","altKey","ctrlKey","shiftKey","pointer","getPointer","mouseDown","mouseMove","setViewportTransform","_createdObject","hiddenTextarea","focus","deltaY","zoomToPoint","offsetX","offsetY","preventDefault","stopPropagation","constrainView","addEventListener","keyDownEvent","keyUpEvent","ev","key","getObjects","make","console","log","tool","addPoint","resize","_resizeTimeoutInner","forEach","enableRotation","getJSON","JSON","stringify","async","getObjUrl","Promise","resolve","toBlob","blob","URL","createObjectURL","loadEditor","loadJSON","json","fonts","revokeObjUrl","url","revokeObjectURL","saveImage","link","document","createElement","setAttribute","toDataURL","format","replace","click","setBorderColor","setBorderPercent","setDrawingMode","setFillColor","setFont","setLineCap","setRedraw","setStrokeColor","setStrokeDash1","setStrokeDash2","setStrokeWidth"],"mappings":"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"}